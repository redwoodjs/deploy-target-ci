api:
  type: backend
  repo_path: coherence

  url_path: /api

  prod:
    command: ["node_modules/.bin/rw-server", "api", "--apiRootPath=/api"]
    dockerfile: Dockerfile.api

  dev:
    command: ["yarn", "rw", "dev", "api", "--apiRootPath=/api"]
    dockerfile: Dockerfile.dev

  local_packages: ["node_modules"]

  system:
    cpu: 2
    memory: 2G
    health_check: "/health"

  resources:
    - name: coherence-db
      engine: postgres
      version: 15
      type: database
      adapter: postgresql

  migration: ["npx", "prisma", "migrate", "deploy", "--schema=api/db/schema.prisma"]

web:
  type: frontend
  repo_path: coherence
  assets_path: web/dist

  prod:
    dockerfile: Dockerfile.web

  dev:
    command: ["yarn", "rw", "dev", "web", "--fwd=\"--allowed-hosts all\""]
    dockerfile: Dockerfile.dev

  local_packages: ["node_modules"]

  system:
    cpu: 2
    memory: 2G
